function strChr(e){return String.fromCharCode(e)}function hexEncode(e){for(var r=[],t=0;t<e.length;t+=2)r.push(String.fromCharCode("0x"+e.substr(t,2)));return btoa(r.join(""))}function sha1(){var e,r,t,o,n,s,c,i,h,a=function(e,r){var t=e<<r|e>>>32-r;return t},f=function(e){var r,t,o="";for(r=7;r>=0;r--)t=e>>>4*r&15,o+=t.toString(16);return o},u=new Array(80),S=1732584193,p=4023233417,d=2562383102,v=271733878,C=3285377520;str=unescape(encodeURIComponent(str));var k=str.length,b=[];for(r=0;k-3>r;r+=4)t=str.charCodeAt(r)<<24|str.charCodeAt(r+1)<<16|str.charCodeAt(r+2)<<8|str.charCodeAt(r+3),b.push(t);switch(k%4){case 0:r=2147483648;break;case 1:r=str.charCodeAt(k-1)<<24|8388608;break;case 2:r=str.charCodeAt(k-2)<<24|str.charCodeAt(k-1)<<16|32768;break;case 3:r=str.charCodeAt(k-3)<<24|str.charCodeAt(k-2)<<16|str.charCodeAt(k-1)<<8|128}for(b.push(r);b.length%16!=14;)b.push(0);for(b.push(k>>>29),b.push(k<<3&4294967295),e=0;e<b.length;e+=16){for(r=0;16>r;r++)u[r]=b[e+r];for(r=16;79>=r;r++)u[r]=a(u[r-3]^u[r-8]^u[r-14]^u[r-16],1);for(o=S,n=p,s=d,c=v,i=C,r=0;19>=r;r++)h=a(o,5)+(n&s|~n&c)+i+u[r]+1518500249&4294967295,i=c,c=s,s=a(n,30),n=o,o=h;for(r=20;39>=r;r++)h=a(o,5)+(n^s^c)+i+u[r]+1859775393&4294967295,i=c,c=s,s=a(n,30),n=o,o=h;for(r=40;59>=r;r++)h=a(o,5)+(n&s|n&c|s&c)+i+u[r]+2400959708&4294967295,i=c,c=s,s=a(n,30),n=o,o=h;for(r=60;79>=r;r++)h=a(o,5)+(n^s^c)+i+u[r]+3395469782&4294967295,i=c,c=s,s=a(n,30),n=o,o=h;S=S+o&4294967295,p=p+n&4294967295,d=d+s&4294967295,v=v+c&4294967295,C=C+i&4294967295}return h=f(S)+f(p)+f(d)+f(v)+f(C),h.toLowerCase()}function WebSocketServer(e){this.socket=null,e=e||{},this.port=e.port||80}WebSocketServer.prototype.initServer=function(){require("net").createServer(this.onServer.bind(this)).listen(this.port)},WebSocketServer.prototype.onServer=function(e){this.socket=e;var r=this;e.on("data",this.handleData.bind(this)),e.on("close",function(){r.emit("close")})},WebSocketServer.prototype.handleData=function(e){var r=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade","Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=",""];if(e.indexOf("Sec-WebSocket-Key")>-1){for(var t=0;t<r.length;t++)this.socket.write(r[t]+"\r\n");this.emit("connection",this)}},WebSocketServer.prototype.send=function(e,r){r=void 0===r?129:r,JSON.parse(e)||(e='{"msg":"'+e+'"}'),this.socket.write(strChr(r)),this.socket.write(strChr(e.length)),this.socket.write(e)},exports.Server=function(e){var r=new WebSocketServer(e);return r.initServer(),r};
